#!/usr/bin/env sh
# Ant installer
# Arguments : version mirrors
. $HOME/bin/install/common.sh

version=$1
shift

if test -z "$1"; then
    # default mirror
    mirror="http://mir2.ovh.net/ftp.apache.org/dist/ant/binaries"
else
    mirror="$1/ant/binaries"
fi

echo "Installing ant"
echo "Checking ant version $version..."
url="${mirror}/apache-ant-${version}-bin.tar.gz"
output="/tmp/apache-ant-${version}-bin.tar.gz"
download_file $url $output

echo "Extracting ant $version..."
tar xzf $output -C $HOME/lib/

echo "Linking ant $version..."
if test -L $HOME/lib/apache-ant; then
    echo "$(basename $0): A ant installation is already present. Change the linking using local_alternative command (if present)."
else
    ln -s $HOME/lib/apache-ant-$version $HOME/lib/apache-ant
fi

echo "Checking ant bin link..."
if ! test -L $HOME/bin/ant-$version; then
    ln -s $HOME/lib/apache-ant-$version/bin/ant $HOME/bin/ant-$version
fi
if ! test -L $HOME/bin/ant; then
    ln -s $HOME/lib/apache-ant/bin/ant $HOME/bin/ant
fi

echo "Cleaning downloaded file..."
rm $output


