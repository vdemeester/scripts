#!/usr/bin/env sh
# Maven installer
# Arguments : version mirrors
. $HOME/bin/install/common.sh

version=$1
shift

if test -z "$1"; then
    # default mirror
    mirror="http://mir2.ovh.net/ftp.apache.org/dist/maven/binaries"
else
    mirror="$1/maven/binaries"
fi

echo "Installing maven"
echo "Checking maven version $version..."
url="${mirror}/apache-maven-${version}-bin.tar.gz"
output="/tmp/apache-maven-${version}-bin.tar.gz"
download_file $url $output

echo "Extracting Maven $version..."
tar xzf $output -C $HOME/lib/

echo "Linking Maven $version..."
if test -L $HOME/lib/apache-maven; then
    echo "$(basename $0): A Maven installation is already present. Change the linking using local_alternative command (if present)."
else
    ln -s $HOME/lib/apache-maven-$version $HOME/lib/apache-maven
fi

echo "Checking Maven bin link..."
if ! test -L $HOME/bin/mvn-$version; then
    ln -s $HOME/lib/apache-maven-$version/bin/mvn $HOME/bin/mvn-$version
fi
if ! test -L $HOME/bin/mvn; then
    ln -s $HOME/lib/apache-maven/bin/mvn $HOME/bin/mvn
fi

echo "Cleaning downloaded file..."
rm $output

