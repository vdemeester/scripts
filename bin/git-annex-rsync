#!/bin/sh
# A script that sync a git-annex folder in a flat folder
# using rsync
SELF=$(basename $0)
set -e
set -x
# Env.
test -z "$RSYNC_EXCLUDES" && RSYNC_EXCLUDES={.git,archive}
# Checks
check-command rsync $SELF

git root >/dev/null
RSYNC_SOURCE="$(git root)/"
RSYNC_DESTINATION=$1
RSYNC_OPTIONS_ADDITIONALS=$2

RSYNC_OPTIONS="-ave ssh --copy-links --copy-dirlinks --progress --size-only --ignore-errors"

#rsync -ave ssh --copy-links --copy-dirlinks / / --progress --size-only --ignore-errors --exclude={.git,archive}
rsync $RSYNC_OPTIONS $RSYNC_SOURCE $RSYNC_DESTINATION --exclude={.git,archive} $RSYNC_OPTIONS_ADDITIONALS 2>/dev/null
